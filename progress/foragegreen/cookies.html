<!DOCTYPE html>

<html>

<head>	

<title>Forage</title>



<style>

@font-face {
font-family: odin;
src: url("./odin.otf") format("opentype");
}

body {
        -webkit-animation: colorPulse 15s infinite alternate;
    }

    @-webkit-keyframes colorPulse {
        0% {background-color: #ffe8ad;}
        25% {background-color: #fbc7ff;}
        50% {background-color: #acffd7;}
        75% {background-color: #ffe8ad;}
        100% {background-color: #fbc7ff;}
    }

p {font-size: 35pt; font-family: odin; color: #444; position: relative;
    top: -10px;}
a {font-size: 35pt; font-family: odin; color: #444; text-decoration: none; }



.logo  {position: relative; width: 15%;  top: 55px;      padding-right: 40px;  padding-left: 40px;   }
.logo2 {position: relative; width: 16%;  top: 55px;      padding-right: 40px;  padding-left: 40px;   }
.logo3 {position: relative; width: 15%;  top: 55px;      padding-right: 40px;  padding-left: 40px;   }
.logo4 {position: relative; width: 13%;  top: 55px;      padding-right: 40px;  padding-left: 40px;   }


#text5
{
background: #fff;
color: #2e1b10;
width:85%;
height: 60px;
padding: 6px 15px 6px 35px;
border-radius: 10px;
box-shadow: 0 1px 0 #ccc inset;
transition:500ms all ease;
}



#line {
  background: green; /* For browsers that do not support gradients */
  background: -webkit-linear-gradient(left, #18a853 , #e7ff31); /* For Safari 5.1 to 6.0 */
  background: -o-linear-gradient(right,     #18a853 , #e7ff31);; /* For Opera 11.1 to 12.0 */
  background: -moz-linear-gradient(right,   #18a853 , #e7ff31);); /* For Firefox 3.6 to 15 */
  background: linear-gradient(to right,     #18a853 , #e7ff31);); /* Standard syntax */
  width: 100%;
  height: 4px;
  
  animation-name: example;
  animation-duration: 4s;

  position: relative;
  top: -70px;

}




#bu2 {width:20%;
    position: relative;
    left: 235px; }

#bu3 {width:20%; 
    position: relative;
    left: -235px;}

button
{
  background:  #18a853;
  background: -webkit-linear-gradient(left, #18a853 , #c1ff31); /* For Safari 5.1 to 6.0 */
  background: -o-linear-gradient(right,     #18a853 , #c1ff31);; /* For Opera 11.1 to 12.0 */
  background: -moz-linear-gradient(right,   #18a853 , #c1ff31);); /* For Firefox 3.6 to 15 */
  background: linear-gradient(to right,     #18a853 , #c1ff31);); /* Standard syntax */
color: #ccc;
width:90%;
height: 80px;
padding: 6px 15px 6px 35px;
border-radius: 10px;
box-shadow: 0 1px 0 #ccc inset;
transition:500ms all ease;
position: relative; top: 0px;
font-family: sans-serif; font-size: 35px; color: #fff!important;
font-family: odin;

}

input {width: 400px; height: 40px; font-size: 20pt; }

.icon1 { width: 95%;
  height: 500px; 
  background-color: rgba(255, 243, 162, 0.4);
   border-radius: 20px;
  }


.imgic { width: 28.5%;
    position: relative;
    right: 305px;
    width: 28.5%;
    position: relative;
    right: 305px;
    top: 70px;
    border-radius: 20px;

   }
.typeic {font-size: 45px; position: relative; top:-380px; left: 110px; color: #18a853; font-family: odin; max-width: 500px; text-align: left;}
.typeic2 {font-size: 35px; position: relative; top: -417px; left: -20px; color: #444; font-family: odin;}
.typeic3 {font-size: 40px; position: relative; top: -590px; left: 170px; text-align: left; width: 550px; color: #444; font-family: odin; }
.tytle {font-size: 70px;  color: #444; font-family: odin; max-width: 500px; }

.cookr{    position: relative;
   top: -657px;
    width: 8%;
    left: 458px;}

    .share1{    position: relative;
    top: -675px;
    width: 4%;
    left: -75px;}

.share2{    position: relative;
    top: -675px;
    width: 7%;
    left: -75px;}

</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://rawgithub.com/jashkenas/underscore/master/underscore-min.js"></script>


</head>
<body> <center>
  <a name="top"></a>
  <a href="set.html"><img class="logo" src="./img/settings.png" ></img></a>
  <a href="cookies.html"> <img class="logo2" src="./logo/sh.png"></img></a>
  <a href="add.html"><img class="logo3" src="./img/new.png"></img></a>
       <a href="idea.html"><img class="logo4" src="./img/bulb.png"></img><br><br></a>


<br><br><br><br><br><br><br><br><br>

<div id="line">

<br><br><br>

  <input id="text5" autocomplete="on" type="text" name="input" value="" placeholder="" list="categories" onchange="search()"></input>
  <datalist id="categories"></datalist>

  <button type="submit" value="searchBtn" onclick="search()">Forage</button>

<br><br>
<p class="tytle">Dish Of The Day</p><br><br>

<div id="contence"></div>

<br><br><br>
  <button id="bu3" onclick="prevPage()">Back</button>
  <button id="bu2" onclick="nextPage()">Next</button>
  

<br><br>



<br><br><br><br><br><br><br><br><br><br><br><br>

<div id="line">
<br><br><br><br><br><br><br><br>
<p>Created by: <a href="www.maverickmedia.org.uk">Maverick Media</a></p>

</center>

<script>

console.log(_);    

var numberOfpages = 0;
var recepies = [];



    function search() {

      var matchString = $("#text5").val();


      var data = _.filter(recepies, function(recpie) {

            var re = new RegExp(matchString,"g");

            console.log(recpie)

            if(recpie.Method.match(re)) return true;
            if(recpie.description.match(re)) return true;
            if(recpie.ingredients.match(re)) return true;
            if(recpie.name.match(re)) return true;
      })


          if(data.length == 1) {
            window.location.href = "/rec.html?id=" + data[0].id;
          }

          console.log("change", matchString, data);
          //drawResults(data);

    }









    function showRecepie(id) {
      console.log("show recipes", id);
    }






  
    $.get('/api/recipes', function(data) {

        drawResults(data);
    })

function drawResults(data) {
      console.log("recipes", data);


      recepies = data;

      console.log("this is what I got from the server for dropdown", data);
      
      var options = '';

      for(var i = 0; i < data.length; i++) {  
        options += '<option value="'+data[i].name+'"" />';
      }


      $('#categories').html(options)







      $('#contence').html("");

      var htmlsegment = "";
      var resultsPerPage = 5;

      numberOfpages = Math.floor(data.length / resultsPerPage);
      console.log("number of pages", numberOfpages)

      var startPos = page * resultsPerPage;

      for(var i = startPos; i < (startPos + resultsPerPage); i++) {  

        var dot= "";

        if (data[i].name.length > 22) dot = "..."

            var bit = '<div class="icon1" >'+

            '<a href="/rec.html?id='+data[i].id+'">'+
            '<img class="imgic" src="'+ data[i].img +'">'+
            '<p class="typeic">'+ data[i].name.substr(0,22) + dot +'</p>'+
            '<p class="typeic2">Ingredience:</p><br><br>'+
            '<p class="typeic3">' +data[i].ingredients.substr(0,175)+ dot +
            '</p><br>'+
            '<img class="cookr" src="./logo/sh.png">'+
            '<img class="share2" src="./img/share.png">'+
            '<img class="share1" src="./img/add2.png">'+
            '</a>'+

            '</div>'+
            '<br><br>';


            htmlsegment = htmlsegment + bit;



      }

      $('#contence').html(htmlsegment);




}




var QueryString = function () {
  // This function is anonymous, is executed immediately and 
  // the return value is assigned to QueryString!
  var query_string = {};
  var query = window.location.search.substring(1);
  var vars = query.split("&");
  for (var i=0;i<vars.length;i++) {
    var pair = vars[i].split("=");
        // If first entry with this name
    if (typeof query_string[pair[0]] === "undefined") {
      query_string[pair[0]] = decodeURIComponent(pair[1]);
        // If second entry with this name
    } else if (typeof query_string[pair[0]] === "string") {
      var arr = [ query_string[pair[0]],decodeURIComponent(pair[1]) ];
      query_string[pair[0]] = arr;
        // If third or later entry with this name
    } else {
      query_string[pair[0]].push(decodeURIComponent(pair[1]));
    }
  } 
  return query_string;
}();


var page = 1;

if(!QueryString.page) { 

  insertParam("page", page); 

} else {

  page = parseInt(QueryString.page);

}

// pagination
function nextPage() {


  if(page == numberOfpages) return;

  page = page + 1;
  console.log("next", page);
  insertParam("page", page);
}

// pagination
function prevPage() {

  if(page == 0) return;

  page = page - 1;
  console.log("prev", page);
  insertParam("page", page);  
}


function insertParam(key, value)
{
    key = encodeURI(key); value = encodeURI(value);

    var kvp = document.location.search.substr(1).split('&');

    var i=kvp.length; var x; while(i--) 
    {
        x = kvp[i].split('=');

        if (x[0]==key)
        {
            x[1] = value;
            kvp[i] = x.join('=');
            break;
        }
    }

    if(i<0) {kvp[kvp.length] = [key,value].join('=');}

    //this will reload the page, it's likely better to store this until finished
    document.location.search = kvp.join('&'); 
}







  </script>


</body>

<html>